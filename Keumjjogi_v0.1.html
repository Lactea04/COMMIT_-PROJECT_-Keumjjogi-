<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸ˆìª½ì´ â€“ ê¸ˆìœµ í€´ì¦ˆ ë² íƒ€</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
    }

    header {
      background: #222;
      color: #fff;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
    }

    header .title {
      font-weight: 600;
    }

    header .score {
      font-weight: 600;
    }

    .screen {
      display: none;
      padding: 24px 16px 40px;
      max-width: 800px;
      margin: 0 auto;
    }

    .screen.active {
      display: block;
    }

    h1, h2, h3 {
      margin-top: 0;
    }

    button {
      padding: 8px 16px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      margin: 4px 4px 4px 0;
    }

    button.primary {
      background: #2d6cdf;
      color: #fff;
    }

    button.secondary {
      background: #e0e0e0;
      color: #222;
    }

    button.danger {
      background: #e57373;
      color: #fff;
    }

    .card {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      margin-bottom: 16px;
    }

    .stage-map {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .option-btn {
      display: block;
      width: 100%;
      text-align: left;
    }

    .option-btn.selected {
      outline: 2px solid #2d6cdf;
    }

    .progress {
      font-size: 13px;
      color: #555;
      margin-bottom: 8px;
    }

    .tag {
      display: inline-block;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #e3f2fd;
      color: #1565c0;
      margin-left: 6px;
    }

    #feedback {
      margin-top: 12px;
      white-space: pre-line;
    }

    .feedback-correct {
      color: #2e7d32;
      font-weight: 600;
    }

    .feedback-wrong {
      color: #c62828;
      font-weight: 600;
    }

    .clue-box {
      background: #fff3cd;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 13px;
      margin-top: 8px;
      display: inline-block;
    }

    .hint-box {
      background: #e3f2fd;
      border-radius: 6px;
      padding: 8px 10px;
      font-size: 13px;
      margin-top: 8px;
      display: inline-block;
    }

    input[type="text"] {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      margin-top: 4px;
    }

    .clue-list {
      font-size: 18px;
      letter-spacing: 8px;
      margin-top: 12px;
    }

    .summary-box {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      font-size: 14px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <header>
    <div class="title">ê¸ˆìª½ì´ â€“ ê¸ˆìœµ í€´ì¦ˆ ë² íƒ€</div>
    <div class="score">ì ìˆ˜: <span id="scoreDisplay">0</span></div>
  </header>

  <!-- í™ˆ í™”ë©´ -->
  <main id="screen-home" class="screen active">
    <div class="card">
      <h1>ê¸ˆìª½ì´ ê¸ˆìœµ í€´ì¦ˆ</h1>
      <p>
        ê¸ˆìœµ ì§€ì‹ì„<br />
        <strong>â€œìŠ¤í…Œì´ì§€ + í€´ì¦ˆ + ë‹¨ì„œâ€</strong> í˜•ì‹ìœ¼ë¡œ í’€ì–´ë³´ëŠ” ì›¹ ê²Œì„ì˜ ë² íƒ€ ë²„ì „ì…ë‹ˆë‹¤.
      </p>
      <button class="primary" id="btnGoToMap">ê¸ˆìœµì‚¬ ë¡œë“œë§µìœ¼ë¡œ ì´ë™</button>
    </div>
  </main>

  <!-- ìŠ¤í…Œì´ì§€ ë¡œë“œë§µ í™”ë©´ -->
  <main id="screen-roadmap" class="screen">
    <div class="card">
      <h2>ìŠ¤í…Œì´ì§€ ë¡œë“œë§µ</h2>
      <p>í˜„ì¬ëŠ” <strong>ë² íƒ€ ìŠ¤í…Œì´ì§€(ê³¼ì¼ í…Œë§ˆ)</strong>ë§Œ ì—´ë ¤ ìˆìŠµë‹ˆë‹¤.<br>
         ì´í›„ì—ëŠ” ë¦¬ë¨¼ ë¸Œë¼ë”ìŠ¤, ëŒ€ê³µí™© ë“± ê¸ˆìœµì‚¬ ì‚¬ê±´ë“¤ì´ ì¶”ê°€ë  ì˜ˆì •ì…ë‹ˆë‹¤.</p>
    </div>

    <div class="stage-map">
      <div class="card">
        <h3>ìŠ¤í…Œì´ì§€ 1 â€“ ê³¼ì¼ ìŠ¤í…Œì´ì§€</h3>
        <p>ê°„ë‹¨í•œ ê³¼ì¼ ë¬¸ì œë¥¼ í’€ë©°, ìµœì¢… ì •ë‹µ <code>APPLE</code>ì„ ë§ì¶”ëŠ” í…ŒìŠ¤íŠ¸ìš© ìŠ¤í…Œì´ì§€ì…ë‹ˆë‹¤.</p>
        <button class="primary" id="btnEnterStage1">ìŠ¤í…Œì´ì§€ 1 ì§„ì…</button>
      </div>
    </div>

    <button class="secondary" id="btnBackToHome">ì‹œì‘ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </main>

  <!-- í€´ì¦ˆ í™”ë©´ (ì¼ë°˜ë¬¸ì œ + í…Œë§ˆë¬¸ì œ ê³µìš©) -->
  <main id="screen-quiz" class="screen">
    <div class="card">
      <div class="progress">
        <span id="stageTitleLabel"></span>
        <span id="phaseLabel" class="tag"></span>
        <br />
        <span id="questionProgress"></span>
      </div>

      <h2 id="questionText"></h2>

      <div id="optionsContainer"></div>

      <div style="margin-top: 12px;">
        <button class="primary" id="btnSubmit">ì •ë‹µ ì œì¶œ</button>
        <button class="secondary" id="btnNext" disabled>ë‹¤ìŒ ë¬¸ì œ</button>
      </div>

      <div style="margin-top: 8px;">
        <button class="secondary" id="btnShowHint">íŒíŠ¸ ë³´ê¸°</button>
        <button class="secondary" id="btnShowClues">ë‹¨ì„œ ë³´ê¸°</button>
        <button class="danger" id="btnBackToMapInQuiz">ë¡œë“œë§µìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>

      <div id="feedback"></div>
    </div>
  </main>

  <!-- ë‹¨ì„œ ë³´ê¸° í™”ë©´ -->
  <main id="screen-clues" class="screen">
    <div class="card">
      <h2>ì§€ê¸ˆê¹Œì§€ ëª¨ì€ ë‹¨ì„œ</h2>
      <p>ì´ ë‹¨ì„œë“¤ì„ ì¡°í•©í•´ì„œ ìŠ¤í…Œì´ì§€ í…Œë§ˆ ë¬¸ì œë¥¼ í’€ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
      <div id="clueList" class="clue-list">ë‹¨ì„œê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</div>
    </div>
    <button class="secondary" id="btnBackToQuizFromClues">í€´ì¦ˆë¡œ ëŒì•„ê°€ê¸°</button>
  </main>

  <!-- ìŠ¤í…Œì´ì§€ ìš”ì•½ í™”ë©´ -->
  <main id="screen-summary" class="screen">
    <div class="card">
      <h2>ìŠ¤í…Œì´ì§€ ìš”ì•½</h2>
      <p>ìŠ¤í…Œì´ì§€ë¥¼ í´ë¦¬ì–´í–ˆìŠµë‹ˆë‹¤ ğŸ‰</p>
      <div class="summary-box">
        <p id="summaryText"></p>
        <p><strong>ìµœì¢… ì ìˆ˜:</strong> <span id="finalScore"></span>ì </p>
      </div>
    </div>
    <button class="primary" id="btnBackToMapFromSummary">ìŠ¤í…Œì´ì§€ ë¡œë“œë§µìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  </main>

  <script>
    /********************************
     * 1. ìŠ¤í…Œì´ì§€ ë°ì´í„° (ë² íƒ€ ë²„ì „)
     ********************************/
    const stage1 = {
      stageId: "stage1",
      title: "ê³¼ì¼ ìŠ¤í…Œì´ì§€",
      summary: "ì´ë²ˆ í…Œë§ˆëŠ” ê³¼ì¼ì´ì—ˆìŠµë‹ˆë‹¤! ì‹¤ì œ ë²„ì „ì—ì„œëŠ” ê¸ˆìœµì‚¬ ì‚¬ê±´(ì˜ˆ: ë¦¬ë¨¼ ë¸Œë¼ë”ìŠ¤, ëŒ€ê³µí™© ë“±)ì— ëŒ€í•œ ìŠ¤í† ë¦¬ì™€ ì •ë¦¬ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤.",
      questions: [
        {
          id: "q1",
          type: "mcq", // ê°ê´€ì‹
          question: "ë‹¤ìŒ ì¤‘ ë¹¨ê°„ìƒ‰ ê³¼ì¼ì€?",
          options: ["ë°”ë‚˜ë‚˜", "ì‚¬ê³¼", "í¬ë„"],
          answer: 1,
          hint: "í•œêµ­ ì‚¬ëŒë“¤ì´ ì œì¼ ë§ì´ ë¨¹ëŠ” ê³¼ì¼ ì¤‘ í•˜ë‚˜ì˜ˆìš”.",
          clue: "A",
          explanation: "ì„¸ ê³¼ì¼ ì¤‘ì—ì„œ ì¼ë°˜ì ìœ¼ë¡œ ë¹¨ê°„ìƒ‰ì¸ ê³¼ì¼ì€ 'ì‚¬ê³¼'ì…ë‹ˆë‹¤."
        },
        {
          id: "q2",
          type: "short", // ì£¼ê´€ì‹
          question: "strawberryë¥¼ í•œêµ­ì–´ë¡œ í•˜ë©´ ë¬´ì—‡ì¸ê°€ìš”?",
          answer: "ë”¸ê¸°",
          hint: "ë¹¨ê°„ìƒ‰ì´ê³ , ì¼€ì´í¬ ìœ„ì—ë„ ìì£¼ ì˜¬ë¼ê°‘ë‹ˆë‹¤.",
          clue: "P",
          explanation: "strawberryëŠ” í•œêµ­ì–´ë¡œ 'ë”¸ê¸°'ì…ë‹ˆë‹¤."
        },
        {
          id: "q3",
          type: "mcq",
          question: "ë‹¤ìŒ ì¤‘ ê»ì§ˆì„ ê¹Œì„œ ë¨¹ëŠ” ê³¼ì¼ì€?",
          options: ["í¬ë„", "ìˆ˜ë°•", "ê·¤"],
          answer: 2,
          hint: "ê²¨ìš¸ì² ì— ë§ì´ ë¨¹ëŠ” ê·¤ì„ ë– ì˜¬ë ¤ ë³´ì„¸ìš”.",
          clue: "P",
          explanation: "í¬ë„ì™€ ìˆ˜ë°•ë„ ê»ì§ˆì„ ì œê±°í•˜ì§€ë§Œ, ì—¬ê¸°ì„œ ëŒ€í‘œì ì¸ ê»ì§ˆ ê¹Œë¨¹ëŠ” ê³¼ì¼ì€ 'ê·¤'ì…ë‹ˆë‹¤."
        },
        {
          id: "q4",
          type: "mcq",
          question: "ë‹¤ìŒ ì¤‘ ê³¼ì¼ì´ ì•„ë‹Œ ê²ƒì€?",
          options: ["ì‚¬ê³¼", "í† ë§ˆí† ", "ê°ì"],
          answer: 2,
          hint: "ì§€í•˜ì—ì„œ ìë¼ëŠ” ì‹ë¬¼ì„ ë– ì˜¬ë ¤ ë³´ì„¸ìš”.",
          clue: "L",
          explanation: "ê°ìëŠ” ë¿Œë¦¬ì±„ì†Œì…ë‹ˆë‹¤. ì‚¬ê³¼ì™€ í† ë§ˆí† ëŠ” ë„“ê²Œ ë³´ë©´ ê³¼ì¼ë¡œ ë¶„ë¥˜ë˜ê¸°ë„ í•©ë‹ˆë‹¤."
        },
        {
          id: "q5",
          type: "short",
          question: "bananaë¥¼ í•œêµ­ì–´ë¡œ í•˜ë©´ ë¬´ì—‡ì¸ê°€ìš”?",
          answer: "ë°”ë‚˜ë‚˜",
          hint: "ë…¸ë€ìƒ‰ì´ê³  ê¸¸ì­‰í•œ ê³¼ì¼ì…ë‹ˆë‹¤.",
          clue: "E",
          explanation: "bananaëŠ” í•œêµ­ì–´ë¡œ 'ë°”ë‚˜ë‚˜'ì…ë‹ˆë‹¤."
        },
        // ë§ˆì§€ë§‰ì€ í…Œë§ˆ ë¬¸ì œ
        {
          id: "themeQuestion",
          type: "short",
          question: "ì§€ê¸ˆê¹Œì§€ ëª¨ì€ ë‹¨ì„œë¥¼ ì¡°í•©í•˜ë©´ ì–´ë–¤ ë‹¨ì–´ê°€ ë ê¹Œìš”? (ì˜ì–´ ëŒ€ë¬¸ìë¡œ ì…ë ¥)",
          answer: "APPLE",
          hint: "ë¹¨ê°›ê³  ë‘¥ê·¼ ê³¼ì¼ì´ì—ìš”.",
          // í…Œë§ˆ ë¬¸ì œëŠ” clue ì—†ìŒ
          explanation: "ì´ë²ˆ ìŠ¤í…Œì´ì§€ì˜ í…Œë§ˆëŠ” 'APPLE'ì´ì—ˆìŠµë‹ˆë‹¤."
        }
      ]
    };

    /********************************
     * 2. ìƒíƒœ ë³€ìˆ˜
     ********************************/
    let currentStage = null;          // í˜„ì¬ ìŠ¤í…Œì´ì§€ ë°ì´í„°
    let currentQuestionIndex = 0;     // í˜„ì¬ ë¬¸ì œ ì¸ë±ìŠ¤
    let score = 0;                    // í˜„ì¬ ì ìˆ˜
    let clues = [];                   // ìˆ˜ì§‘ëœ ë‹¨ì„œë“¤ (ë¬¸ì ë°°ì—´)
    let hasClearedCurrent = false;    // í˜„ì¬ ë¬¸ì œë¥¼ ì´ë¯¸ ì •ë‹µ ì²˜ë¦¬í–ˆëŠ”ì§€ ì—¬ë¶€

    const screens = ["home", "roadmap", "quiz", "clues", "summary"];

    /********************************
     * 3. í™”ë©´ ì „í™˜ ê³µí†µ í•¨ìˆ˜
     ********************************/
    function showScreen(name) {
      screens.forEach((s) => {
        const el = document.getElementById(`screen-${s}`);
        if (el) {
          if (s === name) el.classList.add("active");
          else el.classList.remove("active");
        }
      });
      updateScoreDisplay();
    }

    function updateScoreDisplay() {
      document.getElementById("scoreDisplay").textContent = score;
    }

    /********************************
     * 4. ìŠ¤í…Œì´ì§€ ì‹œì‘/ì´ˆê¸°í™”
     ********************************/
    function resetStageState() {
      score = 0;
      clues = [];
      currentQuestionIndex = 0;
      hasClearedCurrent = false;
      updateScoreDisplay();
    }

    function enterStage1() {
      currentStage = stage1;
      resetStageState();
      renderQuestion();
      showScreen("quiz");
    }

    /********************************
     * 5. ë¬¸ì œ ë Œë”ë§
     ********************************/
    function renderQuestion() {
      const stage = currentStage;
      const totalQuestions = stage.questions.length;
      const themeIndex = totalQuestions - 1;
      const isTheme = currentQuestionIndex === themeIndex;
      const q = stage.questions[currentQuestionIndex];

      hasClearedCurrent = false;
      document.getElementById("feedback").innerHTML = "";
      document.getElementById("btnNext").disabled = true;

      // ğŸ”¹ íŒíŠ¸ ë²„íŠ¼ ì´ˆê¸°í™”
      const hintBtn = document.getElementById("btnShowHint");
      if (q.hint) {
        hintBtn.disabled = false;   // íŒíŠ¸ ìˆìœ¼ë©´ í™œì„±í™”
      } else {
        hintBtn.disabled = true;    // íŒíŠ¸ ì—†ìœ¼ë©´ ë¹„í™œì„±í™”
      }

      // ìƒë‹¨ ì •ë³´
      document.getElementById("stageTitleLabel").textContent = stage.title;

      const phaseLabel = document.getElementById("phaseLabel");
      if (isTheme) {
        phaseLabel.textContent = "í…Œë§ˆ ë¬¸ì œ";
      } else {
        phaseLabel.textContent = "ì¼ë°˜ ë¬¸ì œ";
      }

      const questionProgress = document.getElementById("questionProgress");
      if (isTheme) {
        questionProgress.textContent = `í…Œë§ˆ ë¬¸ì œ (ì´ ${totalQuestions - 1}ë¬¸ì œ + í…Œë§ˆ ë¬¸ì œ 1ê°œ ì¤‘ ë§ˆì§€ë§‰)`;
      } else {
        questionProgress.textContent = `ë¬¸ì œ ${currentQuestionIndex + 1} / ${totalQuestions - 1}`;
      }

      // ì§ˆë¬¸ í…ìŠ¤íŠ¸
      document.getElementById("questionText").textContent = q.question;

      // ë³´ê¸°/ì…ë ¥ ì˜ì—­ ì´ˆê¸°í™”
      const optionsContainer = document.getElementById("optionsContainer");
      optionsContainer.innerHTML = "";

      if (q.type === "mcq") {
        // ê°ê´€ì‹: ë²„íŠ¼ í˜•íƒœ
        q.options.forEach((opt, idx) => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.className = "option-btn secondary";
          btn.dataset.index = idx.toString();
          btn.addEventListener("click", () => {
            // ì„ íƒ í‘œì‹œ
            const all = optionsContainer.querySelectorAll(".option-btn");
            all.forEach((b) => b.classList.remove("selected"));
            btn.classList.add("selected");
          });
          optionsContainer.appendChild(btn);
        });
      } else if (q.type === "short") {
        // ì£¼ê´€ì‹: í…ìŠ¤íŠ¸ ì…ë ¥
        const label = document.createElement("label");
        label.textContent = "ì •ë‹µì„ ì…ë ¥í•˜ì„¸ìš”:";
        const input = document.createElement("input");
        input.type = "text";
        input.id = "shortAnswerInput";
        optionsContainer.appendChild(label);
        optionsContainer.appendChild(input);
      }
    }

    /********************************
     * 6. ì •ë‹µ ì œì¶œ ì²˜ë¦¬
     ********************************/
    function normalizeText(s) {
      return s.trim();
    }

    function handleSubmit() {
      if (!currentStage) return;
      const stage = currentStage;
      const totalQuestions = stage.questions.length;
      const themeIndex = totalQuestions - 1;
      const isTheme = currentQuestionIndex === themeIndex;
      const q = stage.questions[currentQuestionIndex];

      if (hasClearedCurrent) {
        // ì´ë¯¸ ì •ë‹µ ë§ì¶˜ ìƒíƒœì´ë©´ ë¬´ì‹œ
        return;
      }

      let isCorrect = false;
      let feedback = "";
      let feedbackClass = "";

      if (q.type === "mcq") {
        const optionsContainer = document.getElementById("optionsContainer");
        const selected = optionsContainer.querySelector(".option-btn.selected");
        if (!selected) {
          alert("ë³´ê¸°ë¥¼ í•˜ë‚˜ ì„ íƒí•´ ì£¼ì„¸ìš”.");
          return;
        }
        const selectedIndex = parseInt(selected.dataset.index, 10);
        isCorrect = selectedIndex === q.answer;
      } else if (q.type === "short") {
        const input = document.getElementById("shortAnswerInput");
        const userAnswer = normalizeText(input.value || "");
        if (!userAnswer) {
          alert("ì •ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.");
          return;
        }
        const correctAnswer = normalizeText(q.answer);
        isCorrect = userAnswer === correctAnswer;
      }

      if (isCorrect) {
        // ì •ë‹µì¼ ë•Œ ì ìˆ˜ ë¶€ì—¬ (ê°ê´€ì‹ 20, ì£¼ê´€ì‹ 30)
        const baseScore = (q.type === "mcq") ? 20 : 30;
        score += baseScore;
        updateScoreDisplay();

        hasClearedCurrent = true;
        
        // ğŸ”¹ ì •ë‹µ ë§ì¶˜ í›„ íŒíŠ¸ ë²„íŠ¼ ë¹„í™œì„±í™”
        document.getElementById("btnShowHint").disabled = true;

        feedbackClass = "feedback-correct";
        feedback = "ì •ë‹µì…ë‹ˆë‹¤!\n";

        if (q.explanation) {
          feedback += `í•´ì„¤: ${q.explanation}\n`;
        }

        // ë‹¨ì„œ ì§€ê¸‰ (í…Œë§ˆ ë¬¸ì œëŠ” clue ì—†ìŒ)
        if (!isTheme && q.clue) {
          clues.push(q.clue);
          feedback += `ë‹¨ì„œ íšë“: ${q.clue}`;
        }

        // ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("btnNext").disabled = false;
      } else {
        // ì˜¤ë‹µ: -2ì  (ìµœì†Œ 0ì )
        score = Math.max(0, score - 2);
        updateScoreDisplay();

        feedbackClass = "feedback-wrong";
        feedback = "ì˜¤ë‹µì…ë‹ˆë‹¤.\níŒíŠ¸ë¥¼ ì°¸ê³ í•´ ë‹¤ì‹œ ë„ì „í•´ ë³´ì„¸ìš”.";
      }

      const feedbackEl = document.getElementById("feedback");
      feedbackEl.innerHTML = "";
      const p = document.createElement("div");
      p.className = isCorrect ? "feedback-correct" : "feedback-wrong";
      p.textContent = isCorrect ? "ì •ë‹µì…ë‹ˆë‹¤!" : "ì˜¤ë‹µì…ë‹ˆë‹¤.";
      feedbackEl.appendChild(p);

      if (isCorrect && q.explanation) {
        const expl = document.createElement("div");
        expl.textContent = `í•´ì„¤: ${q.explanation}`;
        feedbackEl.appendChild(expl);
      }

      if (isCorrect && !isTheme && q.clue) {
        const clueBox = document.createElement("div");
        clueBox.className = "clue-box";
        clueBox.textContent = `ë‹¨ì„œ íšë“: ${q.clue}`;
        feedbackEl.appendChild(clueBox);
      }

      if (!isCorrect) {
        const hintInfo = document.createElement("div");
        hintInfo.className = "hint-box";
        hintInfo.textContent = "íŒíŠ¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¶”ê°€ ë‹¨ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì´ë²ˆ ë²„ì „ì—ì„œëŠ” íŒíŠ¸ ì‚¬ìš© ì‹œ ì ìˆ˜ íŒ¨ë„í‹°ê°€ ì—†ìŠµë‹ˆë‹¤.)";
        feedbackEl.appendChild(hintInfo);
      }
    }

    /********************************
     * 7. ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™
     ********************************/
    function handleNextQuestion() {
      if (!currentStage) return;

      const totalQuestions = currentStage.questions.length;
      const themeIndex = totalQuestions - 1;
      const isTheme = currentQuestionIndex === themeIndex;

      if (!hasClearedCurrent) {
        alert("ì •ë‹µì„ ë§ì¶˜ í›„ì—ë§Œ ë‹¤ìŒ ë¬¸ì œë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
        return;
      }

      if (!isTheme) {
        // ë‹¤ìŒ ì¼ë°˜ ë¬¸ì œ or í…Œë§ˆ ë¬¸ì œ ì§„ì…
        currentQuestionIndex++;
        renderQuestion();
      } else {
        // í…Œë§ˆ ë¬¸ì œê¹Œì§€ ì™„ë£Œ -> ìŠ¤í…Œì´ì§€ ìš”ì•½ í™”ë©´
        showStageSummary();
      }
    }

    /********************************
     * 8. íŒíŠ¸ / ë‹¨ì„œ ë³´ê¸°
     ********************************/
    function handleShowHint() {
        if (!currentStage) return;
        const q = currentStage.questions[currentQuestionIndex];
        const feedbackEl = document.getElementById("feedback");

        if (!q.hint) {
            alert("ì´ ë¬¸ì œì—ëŠ” ë³„ë„ì˜ íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        // ğŸ”¹ ì´ë¯¸ íŒíŠ¸ê°€ í‘œì‹œë˜ì–´ ìˆë‹¤ë©´ ë” ì´ìƒ ì¶”ê°€í•˜ì§€ ì•ŠìŒ
        if (feedbackEl.querySelector(".hint-box")) {
            return;
        }

        const hintBox = document.createElement("div");
        hintBox.className = "hint-box";
        hintBox.textContent = `íŒíŠ¸: ${q.hint}`;
        feedbackEl.appendChild(hintBox);
    }


    function handleShowCluesScreen() {
      const clueListEl = document.getElementById("clueList");
      if (clues.length === 0) {
        clueListEl.textContent = "ì•„ì§ íšë“í•œ ë‹¨ì„œê°€ ì—†ìŠµë‹ˆë‹¤.";
      } else {
        clueListEl.textContent = clues.join(" ");
      }
      showScreen("clues");
    }

    /********************************
     * 9. ìŠ¤í…Œì´ì§€ ìš”ì•½
     ********************************/
    function showStageSummary() {
      document.getElementById("summaryText").textContent = currentStage.summary;
      document.getElementById("finalScore").textContent = score;
      showScreen("summary");
    }

    /********************************
     * 10. ì´ë²¤íŠ¸ ë°”ì¸ë”©
     ********************************/
    // í™ˆ
    document.getElementById("btnGoToMap").addEventListener("click", () => {
      showScreen("roadmap");
    });

    // ë¡œë“œë§µ
    document.getElementById("btnBackToHome").addEventListener("click", () => {
      showScreen("home");
    });

    document.getElementById("btnEnterStage1").addEventListener("click", () => {
      enterStage1();
    });

    // í€´ì¦ˆ í™”ë©´
    document.getElementById("btnSubmit").addEventListener("click", () => {
      handleSubmit();
    });

    document.getElementById("btnNext").addEventListener("click", () => {
      handleNextQuestion();
    });

    document.getElementById("btnShowHint").addEventListener("click", () => {
      handleShowHint();
    });

    document.getElementById("btnShowClues").addEventListener("click", () => {
      handleShowCluesScreen();
    });

    document.getElementById("btnBackToMapInQuiz").addEventListener("click", () => {
      const ok = confirm("ë¡œë“œë§µìœ¼ë¡œ ëŒì•„ê°€ë©´ í˜„ì¬ ìŠ¤í…Œì´ì§€ ì§„í–‰ ìƒí™©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
      if (ok) {
        resetStageState();
        showScreen("roadmap");
      }
    });

    // ë‹¨ì„œ í™”ë©´
    document.getElementById("btnBackToQuizFromClues").addEventListener("click", () => {
      showScreen("quiz");
    });

    // ìš”ì•½ í™”ë©´
    document.getElementById("btnBackToMapFromSummary").addEventListener("click", () => {
      showScreen("roadmap");
    });

    // ì´ˆê¸° ìƒíƒœ
    updateScoreDisplay();
  </script>
</body>
</html>
